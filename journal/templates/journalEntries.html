{% extends 'journalBase.html' %}
{% load static %}
{% block link %}
    <link rel="stylesheet" href='{% static 'css/journal.css' %}'>
    <script>
        function confirmDelete(event, url) {
            event.preventDefault();
            if (confirm('Are you sure you want to delete this entry?')) {
                window.location.href = url;
            }
        }
        function toggleStar(event, entry_id) {
            event.preventDefault();
            $.ajax({
                url: '{% url 'starJournalEntry' %}',
                data: {
                    'entry_id': entry_id,
                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                },
                type: 'POST',
                dataType: 'json',
                success: function (data) {
                    if (data.is_starred) {
                        event.target.classList.remove('fa-star-o');
                        event.target.classList.add('fa-star');
                        event.target.style.color = 'orange';
                    } else {
                        event.target.classList.remove('fa-star');
                        event.target.classList.add('fa-star-o');
                        event.target.style.color = '';
                    }
                }
            });
        }

    </script>

    </script>
{% endblock link %}
    {% block journalcontent %}
<div class="col-md-8 mr-auto" style="background-color:transparent;">
      <div class="bich">
        <!--content area start-->
    <!-- ENTRIES AREA ENTRIES AREA WITH THE BIG TABLLLLEEEEEEEE -->
        <div class="container my-4">
            <div class="row">
                <div class="col-md-6 mx-auto d-flex">
                    <input class="form-control" id="textSearch" placeholder="Search entries..." />
                </div>
            </div>

            <table class="table mt-4" id="journalEntries">
                <thead class="thead-dark text-center">
                    <tr>
                        <th>Star</th>
                        <th>Title</th>
                        <th>Specialist Access</th>
                        <th>Created At</th>
                        <th>Delete</th>
                    </tr>
                </thead>
                <tbody class="text-center">
                    {% for entry in entries %}
                        <tr>
                            <td>

                              <a title="{% if entry.isStarred == 1 %}isStarred{% else %}not isStarred{% endif %}" href="#" onclick="toggleStar(event, '{{ entry.id }}')">
                                <i class="fa fa-star {% if entry.isStarred != 1 %}fa-star-o{% endif %}" {% if entry.isStarred == 1 %}style="color:orange"{% endif %} aria-hidden="true"></i>
                                <!-- This is Star --> Star
                              </a>

                            </td>
                            <td>
        {#                        <a title="Click to open article" href="{% url 'journal_detail' entries.id %}">{{ entries.title }}</a>#}
                                <a title="Click to open article" href="{% url 'viewJournalEntry' entry_id=entry.id %}">{{ entry.title }}</a>
                            </td>
                            <td>
                                <span hidden id="jnid{{ entry.id }}">!{{ entry.id }}</span>

                                {% if entry.status is None %}
                                    <span class="badge badge-secondary">No Request</span>
                                {% elif entry.status == 0 %}
                                    <button class="journalRequest btn btn-outline-info" value="{{ entry.id }}">Access Request</button>
                                {% elif entry.status == 1 %}
                                    <span class="badge badge-success">Shared</span>
                                {% endif %}
                            </td>
                            <td>{{ entry.created_at}}</td>
                            <td>
                                <a title="Delete Article" href="{% url 'delete_journalEntry' entry_id=entry.id %}" onclick="confirmDelete(event, '{% url 'delete_journalEntry' entry_id=entry.id %}')">
                                    <i class="fa fa-trash" aria-hidden="true"></i>
                                </a>
                            </td>
                        </tr>
                    {% empty %}
                        <tr>
                            <td colspan="7">No records found.</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>


        <script>
                      $(function() {
                        //MODAL EVENTS
                        $(".journalRequest").click(function() {
                          var id = $(this).val();
                          // var jnid=$('#jnid'+id).text();
                          var specname = $('#specname' + id).text();
                          var notes = $('#notes' + id).text();

                          $('#journalRequestModal').modal('show');
                          $('#specname').val(specname);
                          $('#notes').val(notes);
                          $('#journalid').val(id);
                        })

                        var app = (function() {
                          var checkboxInput = ' input[type="checkbox"]',
                            filters = {},
                            rowData = [],
                            values = [],
                            key, value, show, length, divId;

                          var init = function() {
                            app.table = $('#journalEntries').DataTable({
                              "dom": "lrtip" // hide default DataTable search box
                            });

                            $("#textSearch").on('keyup change', function() {
                              console.log('text search for: ' + $(this).val());
                              app.table.search($(this).val()).draw();
                            });

                            $(checkboxInput).prop('checked', false);

                            $(checkboxInput).change(function() {
                              var that = $(this);
                              if (that.hasClass('all')) {
                                $('#' + getFilterCategoryId(that) + checkboxInput).prop('checked', that.prop('checked'));
                              } else {
                                var allInput = $('#' + getFilterCategoryId(that) + checkboxInput + ':first');
                                if (allInput.is(':checked')) {
                                  allInput.prop('checked', false);
                                }
                              }
                              poulateAndApplyFilters();
                            });
                          };

                          return {
                            init: init
                          };
                        })();

                        app.init();

                      });
                    </script>
      </div>
</div>

{% endblock journalcontent %}

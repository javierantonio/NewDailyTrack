{% extends 'journalBase.html' %}
{% load static %}
{% block link %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- DataTables CSS -->
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.css">
<!-- DataTables JS -->
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.js"></script>
    <link rel="stylesheet" href='{% static "css/journal.css" %}'>
    <script>
        // Define the app variable outside the $(document).ready() function
        var app = (function() {
    function init() {
        // Initialize DataTables
        app.table = $('#journalEntries').DataTable({
            "dom": "lrtip" // hide default DataTable search box
        });

        // Event handler for text search
        $("#textSearch").on('keyup change', function() {
            console.log('text search for: ' + $(this).val());
            app.table.search($(this).val()).draw();
        });

        // Initialize modal events
        $(".journalRequest").click(function() {
            var id = $(this).val();
            var specname = $('#specname' + id).text();
            var notes = $('#notes' + id).text();

            $('#journalRequestModal').modal('show');
            $('#specname').val(specname);
            $('#notes').val(notes);
            $('#journalid').val(id);
        });

        // Other initialization code here
    }

    // You can also add other functions and properties related to your app here
    // function someOtherFunction() { ... }

    // Expose public functions and properties
    return {
        init: init,
        // someOtherFunction: someOtherFunction
    };
})();

$(document).ready(function() {
    app.init();
});

        $(document).ready(function() {
            app.init();
        });

        function confirmDelete(event, url) {
            event.preventDefault();
            if (confirm('Are you sure you want to delete this entry?')) {
                window.location.href = url;
            }
        }
        function toggleStar(event, entry_id) {
            event.preventDefault();
            $.ajax({
                url: '{% url "starJournalEntry" %}',
                data: {
                    'entry_id': entry_id,
                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                },
                type: 'POST',
                dataType: 'json',
                success: function (data) {
                    if (data.is_starred) {
                        event.target.classList.remove('fa-star-o');
                        event.target.classList.add('fa-star');
                        event.target.style.color = 'orange';
                    } else {
                        event.target.classList.remove('fa-star');
                        event.target.classList.add('fa-star-o');
                        event.target.style.color = '';
                    }
                }
            });
        }

    </script>
{% endblock link %}
{% block journalcontent %}
<div class="col-md-8 mr-auto" style="background-color:transparent;">
      <div class="bich">
        <!--content area start-->
    <!-- ENTRIES AREA ENTRIES AREA WITH THE BIG TABLLLLEEEEEEEE -->
        <div class="container my-4">
            <div class="row">
                <div class="col-md-6 mx-auto d-flex">
                    <input class="form-control" id="textSearch" placeholder="Search entries..." />
                </div>
            </div>

            <table class="table mt-4" id="journalEntries">
                <thead class="thead-dark text-center">
                    <tr>
                        <th>Star</th>
                        <th>Title</th>
                        <th>Specialist Access</th>
                        <th>Created At</th>
                        <th>Delete</th>
                    </tr>
                </thead>
                <tbody class="text-center">
                    {% for entry in entries %}
                        <tr>
                            <td>

                              <a title="{% if entry.isStarred == 1 %}isStarred{% else %}not isStarred{% endif %}" href="#" onclick="toggleStar(event, '{{ entry.id }}')">
                                <i class="fa fa-star {% if entry.isStarred != 1 %}fa-star-o{% endif %}" {% if entry.isStarred == 1 %}style="color:orange"{% endif %} aria-hidden="true"></i>
                                <!-- This is Star --> Star
                              </a>

                            </td>
                            <td>
        {#                        <a title="Click to open article" href="{% url 'journal_detail' entries.id %}">{{ entries.title }}</a>#}
                                <a title="Click to open article" href="{% url 'viewJournalEntry' entry_id=entry.id %}">{{ entry.title }}</a>
                            </td>
                            <td>
                                <span hidden id="jnid{{ entry.id }}">!{{ entry.id }}</span>

                                {% if entry.status is None %}
                                    <span class="badge badge-secondary">No Request</span>
                                {% elif entry.status == 0 %}
                                    <button class="journalRequest btn btn-outline-info" value="{{ entry.id }}">Access Request</button>
                                {% elif entry.status == 1 %}
                                    <span class="badge badge-success">Shared</span>
                                {% endif %}
                            </td>
                            <td>{{ entry.created_at}}</td>
                            <td>
                                <!-- <a title="Delete Article" href="{% url 'delete_journalEntry' entry_id=entry.id %}" onclick="confirmDelete(event, '{% url "delete_journalEntry" entry_id=entry.id %}')">

                                    <i class="fa fa-trash" aria-hidden="true"></i>
                                </a> -->
                            </td>
                        </tr>
                    {% empty %}
                        <tr>
                            <td colspan="7">No records found.</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>


        <script>

                    </script>
      </div>
</div>

{% endblock journalcontent %}

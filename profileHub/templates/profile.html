<!-- <!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"> -->

<!-- <title>Patient Profile</title> -->
<!-- <meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="../templates/css/profile.css" rel="stylesheet"> -->

<!-- </head>
<body> -->
{% extends 'profileHubBase.html' %}
<!-- <div class="container">
  <div class="main-body"> -->
{% block profilecontent %}

{% if terminateCodeModal %}
<div class="modal fade terminateModal" id="terminateModal" tabindex="-1" role="dialog" aria-labelledby="editAvailabilityTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">

    <div class="modal-content">

      <div class="modal-header" style="background-color:#03a3a0;color:white;">
        <h5 class="modal-title" id="exampleModalLongTitle">
        <i class="fa fa-calendar" style="margin-right: 5px;"></i>
          Patient Profile
        </h5>

      </div>
      <div class="modal-body">
        <div class="card-header">
          Terminate the Patient Invite?
        </div>
        
        <div class="card-body">
          <div class="body-content">
              <div id="email" class="description"></div>
              <div id="code" class="description"></div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <a href="{% url 'confirmRemove' %}">
        <button type="button" id="btnConfirmTerminate" class="btn-primary" data-dismiss="modal" style="border-radius: 20px;">
          Confirm
        </button></a>
        <button type="button" id="btnCancelTerminate" class="btn-secondary" data-dismiss="modal" style="border-radius: 20px;">Cancel</button>
      </div>
    </div>
  </div>
</div>
{% endif %}


<div class="modal fade disconnectModal" id="disconnectModal" tabindex="-1" role="dialog" aria-labelledby="editAvailabilityTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">

    <div class="modal-content">

      <div class="modal-header" style="background-color:#03a3a0;color:white;">
        <h5 class="modal-title" id="exampleModalLongTitle">
        <i class="fa fa-calendar" style="margin-right: 5px;"></i>
          Patient Profile
        </h5>

      </div>
      <div class="modal-body">
        <div class="card-header">
          Disconnect from the selected Patient?            
          
        </div>
        
        <div class="card-body">
          <div class="body-content">
            <div class="image">
              <img
                src="https://static.vecteezy.com/system/resources/previews/009/292/244/original/default-avatar-icon-of-social-media-user-vector.jpg"
                alt="Admin"
                class="rounded-circle"
                width="100"
              />
            </div>
            <span class="content-data">
              <div id="email" class="description"></div>
              <div id="code" class="description"></div>
            </span>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn-secondary" data-dismiss="modal" style="border-radius: 20px;">Cancel</button>
      </div>
    </div>
  </div>
</div>
<div class="row gutters-sm">
  <!-- sidebar -->
  <div class="col-md-4 mb-3">
    <div class="card">
      <div class="card-body">
        <div class="d-flex flex-column align-items-center text-center">
          <img
            src="https://static.vecteezy.com/system/resources/previews/009/292/244/original/default-avatar-icon-of-social-media-user-vector.jpg"
            alt="Admin"
            class="rounded-circle"
            width="150"
          />

          <div class="mt-3">
            <h4 class="patientName">{{data.firstName }} {{data.lastName }}</h4>
            <p class="text-secondary mb-1 patientEmail"> {{data.email}} </p>
            <hr />

            <!-- Add user id in the link -->
            {% if data.type == 'Patient'  %}
            <a href="{% url 'patientEdit' %}">
            {% elif data.type == 'Specialist'  %}
            <a href="{% url 'specialistEdit' %}">
            {% else %}
            <a href="">
            {% endif %} 
              <button class="btn btn-outline-info editProfile">
                ✏️ Edit Profile
              </button></a
            >
          </div>
        </div>
      </div>
    </div>

    <div class="card mt-3">
      <ul class="list-group list-group-flush">
        {% if licenseNumber %}
        <li
          class="list-group-item d-flex justify-content-between align-items-center flex-wrap"
        >
          <h6 class="mb-0">License Number</h6>
          <span class="text-secondary">{{data.licenseNumber}}</span>
        </li>
        {% endif %}
        <li
          class="list-group-item d-flex justify-content-between align-items-center flex-wrap"
        >
          <h6 class="mb-0">Contact Number</h6>
          <span class="text-secondary">{{data.phone}}</span>
        </li>

        <li
          class="list-group-item d-flex justify-content-between align-items-center flex-wrap"
        >
          <h6 class="mb-0">Birth Date</h6>
          <span class="text-secondary">{{data.birthday}}</span>
        </li>

        <li
          class="list-group-item d-flex justify-content-between align-items-center flex-wrap"
        >
          <h6 class="mb-0">Address</h6>
          <span class="text-secondary">{{data.address}}</span>
        </li>

        <!--If patient is above 18, get rid of this section-->

        {% if guardianEmail %}
        <li
          class="list-group-item d-flex justify-content-between align-items-center flex-wrap"
        >
          <h6 class="mb-0">Guardian E-mail</h6>
          <span class="text-secondary">{{data.guardianEmail}}</span>
        </li>
        {% endif %}
        
      </ul>
    </div>
  </div>

  <!-- menu -->
  <div class="col-md-8 right-div">
    <div class="card mb-3">
      <div class="card-body">
        <div class="row">
          <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
            <!-- <li class="nav-item" role="presentation">
              <button
                class="nav-link active"
                id="pills-home-tab"
                data-bs-toggle="pill"
                data-bs-target="#pills-home"
                type="button"
                role="tab"
                aria-controls="pills-home"
                aria-selected="true"
              >
                Appointments
              </button>
            </li> -->
            {% if data.type == 'Patient'  %}
            <li class="nav-item" role="presentation">
              <button
                class="nav-link active"
                id="specialistsAdded-tab"
                data-bs-toggle="pill"
                data-bs-target="#specialistsAdded"
                type="button"
                role="tab"
                aria-controls="specialistsAdded"
                aria-selected="true"
              >
                Your Added Specialists
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button
                class="nav-link"
                id="add-specialist-tab"
                data-bs-toggle="pill"
                data-bs-target="#add-specialist"
                type="button"
                role="tab"
                aria-controls="add-specialist"
                aria-selected="false"
              >
                Register a Specialist
              </button>
            </li>
            {% endif %}

            {% if data.type == 'Specialist'  %}
            <li class="nav-item" role="presentation">
              <button
                class="nav-link active"
                id="invited-patients-tab"
                data-bs-toggle="pill"
                data-bs-target="#invited-patients"
                type="button"
                role="tab"
                aria-controls="invited-patients"
                aria-selected="true"
              >
                Invited Patients
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button
                class="nav-link"
                id="pending-patients-tab"
                data-bs-toggle="pill"
                data-bs-target="#pending-patients"
                type="button"
                role="tab"
                aria-controls="pending-patients"
                aria-selected="false"
              >
                Pending Patients
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button
                class="nav-link"
                id="history-patients-tab"
                data-bs-toggle="pill"
                data-bs-target="#history-patients"
                type="button"
                role="tab"
                aria-controls="history-patients"
                aria-selected="false"
              >
                Registered Patients
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button
                class="nav-link"
                id="add-patient-tab"
                data-bs-toggle="pill"
                data-bs-target="#add-patient"
                type="button"
                role="tab"
                aria-controls="add-patient"
                aria-selected="false"
              >
                Add New Patient
              </button>
            </li>
            {% endif %}
          </ul>



          <div class="tab-content" id="pills-tabContent">
            <!-- Appointment Table-->
            <!-- <div
              class="tab-pane fade show active patientAppointments"
              id="pills-home"
              role="tabpanel"
              aria-labelledby="pills-home-tab"
            >
              <table class="table table-bordered patientAppointment">
                <thead>
                  <tr>
                    <th scope="col">Appointment</th>
                    <th scope="col">Psychologist Name</th>
                    <th scope="col">Time Start</th>
                    <th scope="col">Status</th>
                  </tr>
                </thead>

                <tbody>
                  <tr>
                    <th scope="row">1</th>
                    <td>Dr. Mark Toronto</td>
                    <td>5:45 PM</td>
                    <td>Pending</td>
                  </tr>
                  <tr>
                    <th scope="row">2</th>
                    <td>Dr. Phil</td>
                    <td>3:45 PM</td>
                    <td>Confirmed</td>
                  </tr>
                </tbody>
              </table>
            </div> -->

            {% if data.type == 'Patient'  %}
            <!--Specialist Added Tab-->

            <div
              class="tab-pane show active specialistsAdded"
              id="specialistsAdded"
              role="tabpanel"
              aria-labelledby="specialistsAdded-tab"
            >
              <div class="container">
                <label for="specialistsAdded" style="font-size: larger; color: rgb(19, 156, 194); font-weight: bold;">
                  Your Specialist/s</label>
              </div>
              <div class="container">
                <p>In this dedicated section, you'll discover an organized list of the mental health specialists with whom you've been
                   paired. Each entry in this list represents a professional who can offer guidance, expertise, and assistance tailored to your 
                   unique needs.</p>
              </div>
              <table class="table table-bordered patientHistory">
                <thead>
                  <tr>
                    <th scope="col">Code</th>
                    <th scope="col">Specialist Name</th>   
                    <th scope="col">Contact Number</th>                                       
                    <th scope="col">Date Started</th>   
                    <th scope="col">Status</th> 
                    <th scope="col">Actions</th>                   
                  </tr>
                </thead>

                <tbody>
                  {% csrf_token %}
                  {% for key, specialist in specialistsData.items %}
                  <tr>
                    <th scope="row">{{ specialist.enrollmentCode }}</th>
                    <td>{{ specialist.specialistName }}</td>
                    <td>{{ specialist.contactNumber }}</td>
                    <td>{{ specialist.dateStarted }}</td>
                    <td>{{ specialist.status }}</td>
                    <td>
                      
                      <a id="disconnectSpecialist" class="disconnectSpecialist" data-code="{{specialist.enrollmentCode}}">
                        Disconnect</a>
                    </td>
                    <!-- <td><i class="fa-solid fa-eye fa-sm fa-fw mr-1"></i>View</td> -->
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>

            <!-- Generate a Success Pop-Up after submitting -->
            <div
              class="tab-pane fade patientCode"
              id="add-specialist"
              role="tabpanel"
              aria-labelledby="add-specialist-tab"
            >
              <form class="form-group" role="form" method="post">
                {% csrf_token %}
                <label for="specialistCode">Enrollment Code:</label>
                <input
                  type="text"
                  class="form-control"
                  id="enrollment-code"
                  name="enrollmentCode"
                  placeholder="Enter enrollment code"
                />
                <button type="submit" class="btn btn-info">Register Specialist</button>
              </form>
              
            </div>

            
            {% endif %}

            {% if data.type == 'Specialist'  %}
            <!-- History Table-->
            <div
              class="tab-pane fade patientHistory"
              id="pending-patients"
              role="tabpanel"
              aria-labelledby="pending-patients-tab"
            >
            
              <table class="table table-bordered patientHistory">
                <thead>
                  <tr>
                    <th scope="col">Patient Code</th>
                    <th scope="col">Patient Email</th>                    
                    <th scope="col">Date Invited</th> 
                    <th scope="col">Actions</th>                    
                  </tr>
                </thead>

                <tbody>
                  {% for patient in patientsData.0 %}
                  <tr>
                    <th scope="row">{{ patient.enrollmentCode }}</th>
                    <td>{{ patient.patientEmail }}</td>
                    <td>{{ patient.created_at }}</td>
                    
                    <td>
                      {% csrf_token %}
                      <a id="terminateInvite" class="terminateInvite" data-code="{{patient.enrollmentCode}}">
                        Cancel</a>
                    </td>
                    
                    <!-- <a href="{# url 'removePatient' code=patient.enrollmentCode #}"></a> -->
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
            <div
              class="tab-pane show active patientHistory"
              id="invited-patients"
              role="tabpanel"
              aria-labelledby="invited-patients-tab"
            >
            <table class="table table-bordered patientHistory">
              <thead>
                <tr>
                  <th scope="col">Patient Code</th>
                  <th scope="col">Patient Email</th>                    
                  <th scope="col">Date Invited</th> 
                  <th scope="col">Status</th>                    
                </tr>
              </thead>

              <tbody>
                {% for patient in patientsData.1 %}
                <tr>
                  <th scope="row">{{ patient.enrollmentCode }}</th>
                  <td>{{ patient.patientEmail }}</td>
                  <td>{{ patient.created_at }}</td>                  
                  <td>{{ patient.enrollmentStatus }}</td>
                  
                  <!-- <a href="{# url 'removePatient' code=patient.enrollmentCode #}"></a> -->
                </tr>
                {% endfor %}
              </tbody>
            </table>
            </div>
            <div
              class="tab-pane fade patientHistory"
              id="history-patients"
              role="tabpanel"
              aria-labelledby="history-patients-tab"
            >
            <table class="table table-bordered patientHistory">
              <thead>
                <tr>
                  <th scope="col">Patient Code</th>
                  <th scope="col">Patient Name</th>                    
                  <th scope="col">Date Registered</th> 
                  <th scope="col">Status</th>  
                  <th scope="col">Actions</th>                   
                </tr>
              </thead>

              <tbody>
                {% for key, patient in patientsData.2.items %}
                <tr>
                  <th scope="row">{{ patient.enrollmentCode }}</th>
                  <td>{{ patient.patientName }}</td>
                  <td>{{ patient.created_at }}</td>
                  <td>{{ patient.status }}</td>
                  <td>
                    {% csrf_token %}
                    <a id="disconnectPatient" class="disconnectPatient" data-code="{{patient.enrollmentCode}}">
                      Disconnect</a>
                  </td>
                  <!-- <a href="{# url 'removePatient' code=patient.enrollmentCode #}"></a> -->
                </tr>
                {% endfor %}
              </tbody>
            </table>
            </div>

           
            <!-- Generate a Pop-Up showing the patient code after submitting -->
            <div
              class="tab-pane fade patientCode"
              id="add-patient"
              role="tabpanel"
              aria-labelledby="add-patient-tab"
            >
              <form class="form-group" role="form" method="post">
                {% csrf_token %}
                <label for="specialistCode">Patient Email:</label>
                <input
                  type="email"
                  class="form-control"
                  id="patient-email"
                  name="patientEmail"
                  placeholder="Enter patient email"
                />
                <button type="submit" class="btn btn-info">Add New Patient</button>
              </form>
              
            </div>

            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  $(document).ready(function () {
    // $(".disconnectPatient").click(function(){
    //   var name = document.getElementById("disconnectPatient").getAttribute("name");
    //   var code = document.getElementById("disconnectPatient").getAttribute("code");
    //   $("#name").text(name);
    //   $("#code").text(code);

    //   $('#disconnectModal').modal('show');
    // })
    $(".terminateInvite").click(function(){
      // var email = document.getElementById("terminateInvite").getAttribute("email");
      var code = $(this).data('code');
      // $("#email").text(email);
      $("#code").text(code);
      var csrfToken = document.querySelector('input[name="csrfmiddlewaretoken"]').value;


      // $('#terminateModal').modal('show');
      notif = confirm('Terminate the Patient Invite?')
      if(notif){
        $.ajax({
          type: "POST",
          url: "/specialist-hub/t/",
          data: {
            csrfmiddlewaretoken: csrfToken,
            code: code
          },
          success: function(response) {
            console.log(response);
          },
          error: function(error) {
            console.error('Error:', error);
          }
        });
      }
    })
    // $("#btnCancelTerminate").click(function(){
    //   $('#terminateModal').modal('hide');
    // })
    $(".disconnectPatient").click(function(){
      var code = $(this).data('code');
      var csrfToken = document.querySelector('input[name="csrfmiddlewaretoken"]').value;

      notif = confirm('Disconnect from the patient?')
      if(notif){
        $.ajax({
          type: "POST", 
          url: "/specialist-hub/r/",
          data: {
            csrfmiddlewaretoken: csrfToken,
            code: code
          },
          success: function(response) {
            console.log(response);
          },
          error: function(error) {
            console.error('Error:', error);
          }
        });
      }
    })
    $(".disconnectSpecialist").click(function(){
      var code = $(this).data('code');
      var csrfToken = document.querySelector('input[name="csrfmiddlewaretoken"]').value;
      
      notif = confirm('Disconnect from the selected specialist?')
      if(notif){
        $.ajax({
          type: "POST",
          url: "/patient-hub/r/",
          data: {
            csrfmiddlewaretoken: csrfToken,
            code: code

          },
          success: function(response) {
            console.log(response);
          },
          error: function(error) {
            console.error('Error:', error);
          }
        });
      }
    })

  });
</script>
{% endblock profilecontent %}
